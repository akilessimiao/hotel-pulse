<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HotelPulse - Pousada Praia de Ponta Negra</title>
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
  <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <style>
    body { font-family: 'Arial', sans-serif; }
    .sidebar { width: 250px; height: 100vh; position: fixed; }
    .content { margin-left: 260px; padding: 20px; }
    footer { margin-left: 260px; padding: 20px; background: #f8f8f8; }
  </style>
</head>
<body class="bg-gray-100">
  <!-- Sidebar -->
  <div class="sidebar bg-blue-800 text-white p-4">
    <h1 class="text-2xl font-bold mb-6">Hotel Pulse</h1>
    <p class="text-sm mb-4">Pousada Praia de Ponta Negra</p>
    <nav>
      <ul>
        <li><button onclick="showSection('reservations')" class="w-full text-left py-2 px-4 hover:bg-blue-700">Reservas</button></li>
        <li><button onclick="showSection('checkin')" class="w-full text-left py-2 px-4 hover:bg-blue-700">Check-in/Check-out</button></li>
        <li><button onclick="showSection('tariffs')" class="w-full text-left py-2 px-4 hover:bg-blue-700">Tarifas</button></li>
        <li><button onclick="showSection('prebooking')" class="w-full text-left py-2 px-4 hover:bg-blue-700">Pré-Reserva</button></li>
        <li><button onclick="showSection('reports')" class="w-full text-left py-2 px-4 hover:bg-blue-700">Relatórios</button></li>
      </ul>
    </nav>
  </div>

  <!-- Conteúdo Principal -->
  <div class="content">
    <!-- Seção de Reservas -->
    <div id="reservations" class="section">
      <h2 class="text-2xl font-bold mb-4">Gestão de Reservas</h2>
      <div class="mb-4">
        <input id="roomInput" type="text" placeholder="Número do Quarto" class="border p-2 mr-2">
        <input id="dateInput" type="date" class="border p-2 mr-2">
        <input id="guestInput" type="text" placeholder="Nome do Hóspede" class="border p-2 mr-2">
        <select id="roomTypeInput" class="border p-2 mr-2">
          <option value="standard">Standard</option>
          <option value="deluxe">Deluxe</option>
        </select>
        <button onclick="addReservation()" class="bg-blue-600 text-white p-2 rounded">Adicionar Reserva</button>
      </div>
      <table class="w-full border-collapse border">
        <thead>
          <tr class="bg-gray-200">
            <th class="border p-2">Quarto</th>
            <th class="border p-2">Data</th>
            <th class="border p-2">Hóspede</th>
            <th class="border p-2">Tipo</th>
            <th class="border p-2">Tarifa</th>
            <th class="border p-2">Status</th>
            <th class="border p-2">Ações</th>
          </tr>
        </thead>
        <tbody id="reservationTable"></tbody>
      </table>
    </div>

    <!-- Seção de Check-in/Check-out -->
    <div id="checkin" class="section hidden">
      <h2 class="text-2xl font-bold mb-4">Check-in/Check-out</h2>
      <div class="mb-4">
        <input id="checkinRoom" type="text" placeholder="Número do Quarto" class="border p-2 mr-2">
        <input id="checkinGuest" type="text" placeholder="Nome do Hóspede" class="border p-2 mr-2">
        <button onclick="checkIn()" class="bg-green-600 text-white p-2 rounded">Check-in</button>
        <button onclick="checkOut()" class="bg-red-600 text-white p-2 rounded">Check-out</button>
      </div>
    </div>

    <!-- Seção de Tarifas -->
    <div id="tariffs" class="section hidden">
      <h2 class="text-2xl font-bold mb-4">Gestão de Tarifas</h2>
      <div class="mb-4">
        <select id="tariffRoomType" class="border p-2 mr-2">
          <option value="standard">Standard</option>
          <option value="deluxe">Deluxe</option>
        </select>
        <input id="tariffDateStart" type="date" class="border p-2 mr-2">
        <input id="tariffDateEnd" type="date" class="border p-2 mr-2">
        <input id="tariffPrice" type="number" placeholder="Preço (R$)" class="border p-2 mr-2">
        <button onclick="addTariff()" class="bg-blue-600 text-white p-2 rounded">Adicionar Tarifa</button>
      </div>
      <table class="w-full border-collapse border">
        <thead>
          <tr class="bg-gray-200">
            <th class="border p-2">Tipo de Quarto</th>
            <th class="border p-2">Início</th>
            <th class="border p-2">Fim</th>
            <th class="border p-2">Preço (R$)</th>
            <th class="border p-2">Ações</th>
          </tr>
        </thead>
        <tbody id="tariffTable"></tbody>
      </table>
    </div>

    <!-- Seção de Pré-Reserva -->
    <div id="prebooking" class="section hidden">
      <h2 class="text-2xl font-bold mb-4">Formulário de Pré-Reserva</h2>
      <p class="mb-4">Faça seu pedido de pré-reserva e em breve entraremos em contato.</p>
      <div class="mb-4">
        <h3 class="text-lg font-bold mb-2">Dados de Contato</h3>
        <input id="prebookFirstName" type="text" placeholder="Nome" class="border p-2 mb-2 w-1/2 mr-2">
        <input id="prebookLastName" type="text" placeholder="Sobrenome" class="border p-2 mb-2 w-1/2">
        <input id="prebookCPF" type="text" placeholder="CPF (000.000.000-00)" class="border p-2 mb-2 w-full" pattern="\d{3}\.\d{3}\.\d{3}-\d{2}">
        <input id="prebookEmail" type="email" placeholder="E-mail" class= "border p-2 mb-2 w-full">
        <input id="prebookPhone" type="tel" placeholder="Telefone (+55 (00) 00000-0000)" class="border p-2 mb-2 w-full">
        <h3 class="text-lg font-bold mb-2 mt-4">Sua Reserva</h3>
        <input id="prebookCheckin" type="date" placeholder="Data de Entrada" class="border p-2 mb-2 w-1/2 mr-2">
        <input id="prebookCheckout" type="date" placeholder="Data de Saída" class="border p-2 mb-2 w-1/2">
        <input id="prebookAdults" type="number" placeholder="Adultos" class="border p-2 mb-2 w-1/4 mr-2" min="1">
        <input id="prebookChildren" type="number" placeholder="Crianças" class="border p-2 mb-2 w-1/4" min="0">
        <select id="prebookRoomType" class="border p-2 mb-2 w-1/2">
          <option value="standard">Standard</option>
          <option value="deluxe">Deluxe</option>
        </select>
        <textarea id="prebookObservations" placeholder="Observações (Ex: Quero 2 quartos com cama de casal e ar condicionado)" class="border p-2 mb-2 w-full"></textarea>
        <input id="prebookPromoCode" type="text" placeholder="Código Promocional" class="border p-2 mb-2 w-full">
        <button onclick="submitPrebooking()" class="bg-blue-600 text-white p-2 rounded">Enviar Pré-Reserva</button>
      </div>
      <h3 class="text-xl font-bold mb-2">Pré-Reservas Recebidas</h3>
      <table class="w-full border-collapse border">
        <thead>
          <tr class="bg-gray-200">
            <th class="border p-2">Nome</th>
            <th class="border p-2">E-mail</th>
            <th class="border p-2">CPF</th>
            <th class="border p-2">Check-in</th>
            <th class="border p-2">Check-out</th>
            <th class="border p-2">Ações</th>
          </tr>
        </thead>
        <tbody id="prebookingTable"></tbody>
      </table>
    </div>

    <!-- Seção de Relatórios -->
    <div id="reports" class="section hidden">
      <h2 class="text-2xl font-bold mb-4">Relatórios</h2>
      <canvas id="occupancyChart" width="400" height="200"></canvas>
      <div class="mt-4">
        <button onclick="generateReport()" class="bg-blue-600 text-white p-2 rounded mr-2">Baixar Relatório</button>
        <button onclick="uploadToDrive()" class="bg-green-600 text-white p-2 rounded mr-2">Enviar para Google Drive</button>
        <button onclick="sendReportEmail()" class="bg-purple-600 text-white p-2 rounded">Enviar por E-mail</button>
      </div>
    </div>
  </div>

  <!-- Rodapé -->
  <footer class="text-gray-600">
    <p><strong>Pousada Praia de Ponta Negra</strong></p>
    <p>Rua Luiz Estevam, 2277, Ponta Negra, Natal, Rio Grande do Norte</p>
    <p>Entre em contato: +55 (84) 98719-2094 | pousadapraiadepontanegra13@gmail.com</p>
    <p>©2019 Hospedin | <a href="#" class="underline">Termos de Uso</a> | <a href="#" class="underline">Privacidade</a></p>
  </footer>

  <script>
    // Configurações do Google Drive
    const CLIENT_ID = 'SUA_CLIENT_ID_AQUI'; // Substitua pelo seu Client ID do Google Cloud
    const API_KEY = 'SUA_API_KEY_AQUI'; // Substitua pela sua API Key
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';

    // Configurações do EmailJS
    (function(){emailjs.init('SEU_USER_ID_AQUI');})(); // Substitua pelo seu User ID do EmailJS

    // Inicialização
    let reservations = JSON.parse(localStorage.getItem('reservations')) || [];
    let tariffs = JSON.parse(localStorage.getItem('tariffs')) || [];
    let prebookings = JSON.parse(localStorage.getItem('prebookings')) || [];

    function showSection(sectionId) {
      document.querySelectorAll('.section').forEach(section => section.classList.add('hidden'));
      document.getElementById(sectionId).classList.remove('hidden');
      if (sectionId === 'reports') updateChart();
      if (sectionId === 'tariffs') updateTariffTable();
      if (sectionId === 'prebooking') updatePrebookingTable();
    }

    // Adicionar Reserva
    function addReservation() {
      const room = document.getElementById('roomInput').value;
      const date = document.getElementById('dateInput').value;
      const guest = document.getElementById('guestInput').value;
      const roomType = document.getElementById('roomTypeInput').value;
      if (room && date && guest && roomType) {
        const tariff = getTariff(roomType, date);
        reservations.push({ room, date, guest, roomType, tariff: tariff || 100, status: 'Reservado' });
        localStorage.setItem('reservations', JSON.stringify(reservations));
        updateTable();
        clearReservationInputs();
      } else {
        alert('Preencha todos os campos!');
      }
    }

    // Obter Tarifa
    function getTariff(roomType, date) {
      const checkDate = new Date(date);
      for (let tariff of tariffs) {
        const start = new Date(tariff.start);
        const end = new Date(tariff.end);
        if (tariff.roomType === roomType && checkDate >= start && checkDate <= end) {
          return tariff.price;
        }
      }
      return null; // Tarifa padrão
    }

    // Check-in
    function checkIn() {
      const room = document.getElementById('checkinRoom').value;
      const guest = document.getElementById('checkinGuest').value;
      const reservation = reservations.find(r => r.room === room && r.status === 'Reservado');
      if (reservation) {
        reservation.status = 'Ocupado';
        localStorage.setItem('reservations', JSON.stringify(reservations));
        updateTable();
      } else {
        alert('Reserva não encontrada!');
      }
    }

    // Check-out
    function checkOut() {
      const room = document.getElementById('checkinRoom').value;
      const reservation = reservations.find(r => r.room === room && r.status === 'Ocupado');
      if (reservation) {
        reservation.status = 'Finalizado';
        localStorage.setItem('reservations', JSON.stringify(reservations));
        updateTable();
      } else {
        alert('Quarto não está ocupado!');
      }
    }

    // Adicionar Tarifa
    function addTariff() {
      const roomType = document.getElementById('tariffRoomType').value;
      const start = document.getElementById('tariffDateStart').value;
      const end = document.getElementById('tariffDateEnd').value;
      const price = parseFloat(document.getElementById('tariffPrice').value);
      if (roomType && start && end && price) {
        tariffs.push({ roomType, start, end, price });
        localStorage.setItem('tariffs', JSON.stringify(tariffs));
        updateTariffTable();
        clearTariffInputs();
      } else {
        alert('Preencha todos os campos!');
      }
    }

    // Enviar Pré-Reserva
    function submitPrebooking() {
      const firstName = document.getElementById('prebookFirstName').value;
      const lastName = document.getElementById('prebookLastName').value;
      const cpf = document.getElementById('prebookCPF').value;
      const email = document.getElementById('prebookEmail').value;
      const phone = document.getElementById('prebookPhone').value;
      const checkin = document.getElementById('prebookCheckin').value;
      const checkout = document.getElementById('prebookCheckout').value;
      const adults = document.getElementById('prebookAdults').value;
      const children = document.getElementById('prebookChildren').value;
      const roomType = document.getElementById('prebookRoomType').value;
      const observations = document.getElementById('prebookObservations').value;
      const promoCode = document.getElementById('prebookPromoCode').value;
      if (firstName && lastName && cpf && email && phone && checkin && checkout && adults && roomType) {
        prebookings.push({ firstName, lastName, cpf, email, phone, checkin, checkout, adults, children, roomType, observations, promoCode });
        localStorage.setItem('prebookings', JSON.stringify(prebookings));
        updatePrebookingTable();
        clearPrebookingInputs();
        alert('Pré-reserva enviada com sucesso! Em breve entraremos em contato.');
      } else {
        alert('Preencha todos os campos obrigatórios!');
      }
    }

    // Atualizar Tabela de Reservas
    function updateTable() {
      const tableBody = document.getElementById('reservationTable');
      tableBody.innerHTML = '';
      reservations.forEach(res => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="border p-2">${res.room}</td>
          <td class="border p-2">${res.date}</td>
          <td class="border p-2">${res.guest}</td>
          <td class="border p-2">${res.roomType}</td>
          <td class="border p-2">R$ ${res.tariff.toFixed(2)}</td>
          <td class="border p-2">${res.status}</td>
          <td class="border p-2">
            <button onclick="deleteReservation('${res.room}', '${res.date}')" class="bg-red-600 text-white p-1 rounded">Excluir</button>
          </td>`;
        tableBody.appendChild(row);
      });
    }

    // Atualizar Tabela de Tarifas
    function updateTariffTable() {
      const tableBody = document.getElementById('tariffTable');
      tableBody.innerHTML = '';
      tariffs.forEach(tariff => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="border p-2">${tariff.roomType}</td>
          <td class="border p-2">${tariff.start}</td>
          <td class="border p-2">${tariff.end}</td>
          <td class="border p-2">R$ ${tariff.price.toFixed(2)}</td>
          <td class="border p-2">
            <button onclick="deleteTariff('${tariff.roomType}', '${tariff.start}')" class="bg-red-600 text-white p-1 rounded">Excluir</button>
          </td>`;
        tableBody.appendChild(row);
      });
    }

    // Atualizar Tabela de Pré-Reservas
    function updatePrebookingTable() {
      const tableBody = document.getElementById('prebookingTable');
      tableBody.innerHTML = '';
      prebookings.forEach(prebook => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="border p-2">${prebook.firstName} ${prebook.lastName}</td>
          <td class="border p-2">${prebook.email}</td>
          <td class="border p-2">${prebook.cpf}</td>
          <td class="border p-2">${prebook.checkin}</td>
          <td class="border p-2">${prebook.checkout}</td>
          <td class="border p-2">
            <button onclick="deletePrebooking('${prebook.email}', '${prebook.checkin}')" class="bg-red-600 text-white p-1 rounded">Excluir</button>
          </td>`;
        tableBody.appendChild(row);
      });
    }

    // Excluir Reserva
    function deleteReservation(room, date) {
      reservations = reservations.filter(r => r.room !== room || r.date !== date);
      localStorage.setItem('reservations', JSON.stringify(reservations));
      updateTable();
    }

    // Excluir Tarifa
    function deleteTariff(roomType, start) {
      tariffs = tariffs.filter(t => t.roomType !== roomType || t.start !== start);
      localStorage.setItem('tariffs', JSON.stringify(tariffs));
      updateTariffTable();
    }

    // Excluir Pré-Reserva
    function deletePrebooking(email, checkin) {
      prebookings = prebookings.filter(p => p.email !== email || p.checkin !== checkin);
      localStorage.setItem('prebookings', JSON.stringify(prebookings));
      updatePrebookingTable();
    }

    // Limpar Inputs
    function clearReservationInputs() {
      document.getElementById('roomInput').value = '';
      document.getElementById('dateInput').value = '';
      document.getElementById('guestInput').value = '';
      document.getElementById('roomTypeInput').value = 'standard';
    }

    function clearTariffInputs() {
      document.getElementById('tariffRoomType').value = 'standard';
      document.getElementById('tariffDateStart').value = '';
      document.getElementById('tariffDateEnd').value = '';
      document.getElementById('tariffPrice').value = '';
    }

    function clearPrebookingInputs() {
      document.getElementById('prebookFirstName').value = '';
      document.getElementById('prebookLastName').value = '';
      document.getElementById('prebookCPF').value = '';
      document.getElementById('prebookEmail').value = '';
      document.getElementById('prebookPhone').value = '';
      document.getElementById('prebookCheckin').value = '';
      document.getElementById('prebookCheckout').value = '';
      document.getElementById('prebookAdults').value = '';
      document.getElementById('prebookChildren').value = '';
      document.getElementById('prebookRoomType').value = 'standard';
      document.getElementById('prebookObservations').value = '';
      document.getElementById('prebookPromoCode').value = '';
    }

    // Atualizar Gráfico
    function updateChart() {
      const ctx = document.getElementById('occupancyChart').getContext('2d');
      const statusCount = {
        Reservado: reservations.filter(r => r.status === 'Reservado').length,
        Ocupado: reservations.filter(r => r.status === 'Ocupado').length,
        Finalizado: reservations.filter(r => r.status === 'Finalizado').length
      };
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Reservado', 'Ocupado', 'Finalizado'],
          datasets: [{
            label: 'Status das Reservas',
            data: [statusCount.Reservado, statusCount.Ocupado, statusCount.Finalizado],
            backgroundColor: ['#3498db', '#2ecc71', '#e74c3c']
          }]
        }
      });
    }

    // Gerar Relatório
    function generateReport() {
      const report = {
        reservations: reservations,
        tariffs: tariffs,
        prebookings: prebookings
      };
      const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'relatorio_hotelpulse.json';
      a.click();
    }

    // Upload para Google Drive
    function uploadToDrive() {
      gapi.load('client:auth2', () => {
        gapi.client.init({
          apiKey: API_KEY,
          clientId: CLIENT_ID,
          scope: SCOPES
        }).then(() => {
          gapi.auth2.getAuthInstance().signIn().then(() => {
            const report = {
              reservations: reservations,
              tariffs: tariffs,
              prebookings: prebookings
            };
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const metadata = {
              name: `relatorio_hotelpulse_${new Date().toISOString()}.json`,
              mimeType: 'application/json'
            };
            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', blob);
            fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
              method: 'POST',
              headers: new Headers({ 'Authorization': 'Bearer ' + gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token }),
              body: form
            }).then(response => response.json()).then(data => {
              alert('Backup enviado para o Google Drive com sucesso!');
            }).catch(error => {
              alert('Erro ao enviar para o Google Drive: ' + error);
            });
          });
        });
      });
    }

    // Enviar Relatório por E-mail
    function sendReportEmail() {
      const report = {
        reservations: reservations,
        tariffs: tariffs,
        prebookings: prebookings
      };
      const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
      const reader = new FileReader();
      reader.onloadend = function() {
        const base64data = reader.result.split(',')[1];
        emailjs.send('SEU_SERVICE_ID_AQUI', 'SEU_TEMPLATE_ID_AQUI', {
          to_email: 'pousadapraiadepontanegra13@gmail.com', // E-mail da pousada
          attachment: base64data,
          filename: `relatorio_hotelpulse_${new Date().toISOString()}.json`
        }).then(() => {
          alert('Relatório enviado por e-mail com sucesso!');
        }).catch(error => {
          alert('Erro ao enviar e-mail: ' + error);
        });
      };
      reader.readAsDataURL(blob);
    }

    // Inicializar Tabelas
    updateTable();
    updateTariffTable();
    updatePrebookingTable();
  </script>
</body>
</html>
